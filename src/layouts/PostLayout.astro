---
import { DateTime } from 'luxon'

import BaseLayout3 from './BaseLayout3.astro'

const { title, description, date, revisionDate = null, lang = 'en-us' } = Astro.props.content
const permalink = new URL(Astro.url.pathname, Astro.site)

const isoDate = DateTime.fromISO(date).toISODate()
const formattedDate = DateTime.fromISO(date).setLocale(lang).toLocaleString(DateTime.DATE_MED)

const isoRevisionDate = DateTime.fromISO(revisionDate).toISODate()
const formattedRevisionDate = DateTime.fromISO(revisionDate).setLocale(lang).toLocaleString(DateTime.DATE_MED)

const headProps = {
	title,
	description,
	permalink,
}
---

<style>
	@layer globals {
		section:not(:last-child) {
			margin-bottom: var(--size-8);
		}
	}
</style>

<style is:inline>
	.content {
		a {
			color: var(--color-foreground);

			&:hover {
				background-color: var(--color-secondary);
			}
		}

		pre {
			/* Default value I found with devtools */
			--margin: 1.25rem;

			margin: 0 0 var(--margin) 0;
			/* Needed for "Copy" button */
			position: relative;

			.copy {
				font-size: 1rem;
				height: var(--margin);
				position: absolute;
				right: 0.5rem;
				top: calc(-1 * var(--margin));
			}
		}

		code {
			overflow-x: scroll;
			white-space: pre-wrap;
		}

		p {
			margin-bottom: 1.25rem;
		}
	}
</style>

<BaseLayout3>
	<section>
		<h1>{title}</h1>
	</section>

	<section class="intro">
		{
			date && (
				<p>
					<span>Posted on:&nbsp;</span>
					<time id="date" datetime={isoDate}>
						{formattedDate}
					</time>
				</p>
			)
		}
		{
			revisionDate && (
				<p>
					<span>Updated on:&nbsp;</span>
					<time id="date" datetime={isoRevisionDate}>
						{formattedRevisionDate}
					</time>
				</p>
			)
		}
	</section>

	<section class="content">
		<slot />
	</section>

	<!-- <script> -->
	<!-- 	const $preBlocks = document.querySelectorAll('pre') -->

	<!-- 	for (const $preBlock of $preBlocks.values()) { -->
	<!-- 		console.log($preBlock) -->
	<!-- 		const copyButton = document.createElement('button') -->
	<!-- 		copyButton.classList.add('copy') -->
	<!-- 		copyButton.textContent = 'Copy' -->

	<!-- 		copyButton.addEventListener('click', () => { -->
	<!-- 			const $codeBlock = $preBlock.querySelector('code') -->
	<!-- 			const textToCopy = $codeBlock.textContent -->
	<!-- 			const invisibleInput = document.createElement('input') -->
	<!-- 			invisibleInput.style.opacity = '0' -->
	<!-- 			invisibleInput.setAttribute('value', textToCopy) -->
	<!-- 			document.body.append(invisibleInput) -->
	<!-- 			invisibleInput.select() -->

	<!-- 			document.execCommand('copy') -->
	<!-- 			invisibleInput.remove() -->
	<!-- 		}) -->

	<!-- 		$preBlock.prepend(copyButton) -->
	<!-- 	} -->
	<!-- </script> -->
</BaseLayout3>
